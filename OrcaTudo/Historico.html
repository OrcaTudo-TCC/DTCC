<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> histórico de operações </title>
    <script src="https://kit.fontawesome.com/449a3898b7.js" crossorigin="anonymous"></script> <!--Código Font Awesome para os ícones do site-->
    <link rel="stylesheet" href="css/header.css">
    <link rel="stylesheet" href="CSS/Historico.css">
</head>
<body>

    <header>
        <div class="logo">
            <img src="imagens/Logo1.png">
        </div>
        
        <div class="search-bar">
            <input type="text" placeholder="O que você procura na Orça tudo ?">
            <i class="fas fa-search"></i>
        </div>
        <nav>
            <ul>
                <li><a href="#">Dashboard</a></li>
                <li><a href="#">Licitação</a></li>
                <li><a href="#">Cotação</a></li>
                <li><a href="#">Sobre nós</a></li>
            </ul>
        </nav>
        <div class="icons">

            <div class="user-menu">
                <i class="far fa-user" id="user-icon"></i>
                <div class="dropdown-menu" id="dropdown-menu">
                    <a href="#">Configurações</a>
                    <a href="#">Sair da Conta</a>
                </div>
            </div>
           
           
            <i class="fas fa-shopping-cart"></i>
        </div>


        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const userIcon = document.getElementById("user-icon");
                const dropdownMenu = document.getElementById("dropdown-menu");
        
                userIcon.addEventListener("click", function (event) {
                    event.stopPropagation(); // Impede que o clique feche imediatamente
                    dropdownMenu.style.display = (dropdownMenu.style.display === "block") ? "none" : "block";
                });
        
                document.addEventListener("click", function () {
                    dropdownMenu.style.display = "none";
                });
        
                dropdownMenu.addEventListener("click", function (event) {
                    event.stopPropagation(); // Evita que o clique no menu feche ele
                });
            });
        </script>

    </header>



    <container class="principal">

        <div class="historico" >

            <!-- Filtro de status -->
        <label for="status-filter">Filtrar por status:</label>
         <select id="status-filter">
        <option value="todos">Todos</option>
        <option value="Concluído">Concluído</option>
        <option value="Pendente">Pendente</option>
        <option value="Cancelada">Cancelada</option>
        </select>


            <table>
                <caption>Histórico de operações</caption>
                <thead>
                    <tr>
                        <th>num. operação</th>
                        <th>Operação</th>
                        <th>Data <i class="fas fa-sort"></i></th> <!-- Ícone de ordenação -->
                        <th>status</th>
                    </tr>
                </thead>
                <tbody id="tbody">
                    <tr>
                        <td>12134</td>
                        <td>Licitação</td>
                        <td>14/03/2025</td>
                        <td class="status" id="concluido">Concluído</td>
                    </tr>
                    <tr>
                        <td>54321</td>
                        <td>Compra</td>
                        <td>07/03/2025</td>
                        <td class="status" id="pendente">Pendente</td>
                    </tr>
                    <tr>
                        <td>54832</td>
                        <td>Cotação</td>
                        <td>10/03/2025</td>
                        <td class="status" id="concluido">Concluído</td>
                    </tr>
                    <tr>
                        <td>24632</td>
                        <td>Licitação</td>
                        <td>14/03/2025</td>
                        <td class="status" id="cancelada">Cancelada</td>
                    </tr>
                    <tr>
                        <td>87543</td>
                        <td>Compra</td>
                        <td>02/03/2025</td>
                        <td class="status" id="pendente">Pendente</td>
                    </tr>
                    <tr>
                        <td>36987</td>
                        <td>Cotação</td>
                        <td>20/02/2025</td>
                        <td class="status" id="concluido">Concluído</td>
                    </tr>
                    <tr>
                        <td>47892</td>
                        <td>Licitação</td>
                        <td>25/03/2025</td>
                        <td class="status" id="pendente">Pendente</td>
                    </tr>
                    <tr>
                        <td>56932</td>
                        <td>Compra</td>
                        <td>28/02/2025</td>
                        <td class="status" id="concluido">Concluído</td>
                    </tr>
                    <tr>
                        <td>63214</td>
                        <td>Cotação</td>
                        <td>18/03/2025</td>
                        <td class="status" id="pendente">Pendente</td>
                    </tr>
                    <tr>
                        <td>74123</td>
                        <td>Licitação</td>
                        <td>12/03/2025</td>
                        <td class="status" id="cancelada">Cancelada</td>
                    </tr>
                    <tr>
                        <td>85214</td>
                        <td>Compra</td>
                        <td>05/03/2025</td>
                        <td class="status" id="concluido">Concluído</td>
                    </tr>
                    <tr>
                        <td>96541</td>
                        <td>Cotação</td>
                        <td>22/03/2025</td>
                        <td class="status" id="pendente">Pendente</td>
                    </tr>
                </tbody>
            </table>
        </div>


     <!-- Botão para download do histórico em XML -->
<button id="download-btn">Baixar Histórico</button>

    </container>


    <footer>
        <div class="footer-container">
            <div class="footer-section">
                <img src="imagens/Logo.png" alt="OrçaTudo Logo" class="footer-logo">
            </div>
            <div class="footer-section">
                <h3>Ideal Para</h3>
                <ul>
                    <li>Engenheiros Civis</li>
                    <li>Construtoras</li>
                    <li>Orçamentistas</li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Funcionalidades</h3>
                <ul>
                    <li>Cotação de Preços</li>
                    <li>Gestão de Orçamentos</li>
                    <li>Comparação de Materiais</li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Recursos</h3>
                <ul>
                    <li>Lista de Fornecedores</li>
                    <li>Simulação de Custos</li>
                    <li>Dashboard Interativo</li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Sobre</h3>
                <ul>
                    <li><a href="#">Sobre o OrçaTudo</li>
                    <li><a href="#">Contato</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>© 2025 OrçaTudo. Todos os direitos reservados | Política de Privacidade | Termos de Serviço</p>
        </div>
    </footer>

    <script  src="js/operacoes.js"></script>
    <!--Script que faz integração dos dados com a API-->
    <script>
        window.addEventListener('DOMContentLoaded', async () =>{
            response = await getOperacoesByUsuarioId(1);
            if(response.length === 0){
                alert("Nenhuma Operação encontrada");
            }else{
                console.log("Encontrou operações");
                console.log(response);
                console.log("O tamanho da resposta é: ", response.length)
            }
            response.forEach(operacao => {
                //criando uma nova linha no corpo da tabela para inserir as informações
                tbody = document.getElementById('tbody');
                linha = document.createElement('tr');
                tbody.appendChild(linha);

                const numOp = document.createElement('td');
                numOp.textContent = operacao.id;
                const oper = document.createElement('td');
                oper.textContent = capitalizar(operacao.operacao);
                const dataop = document.createElement('td');
                dataop.textContent = operacao.data;
                const statusop = document.createElement('td');
                if(operacao.status == "PENDENTE"){
                    statusop.id = 'pendente';
                }
                if(operacao.status == "CANCELADA"){
                    statusop.id = 'cancelada';
                }
                if(operacao.status == "CONCLUIDA"){
                    statusop.id = 'concluido';
                }
                statusop.textContent = capitalizar(operacao.status);
                linha.appendChild(numOp);
                linha.appendChild(oper);
                linha.appendChild(dataop);
                linha.appendChild(statusop);
            })
            

        })

        function capitalizar(texto) {
            if (!texto) return '';
            return texto.charAt(0).toUpperCase() + texto.slice(1).toLowerCase();
        }

    </script>

    <!--scrpit para animações e funcionalidades da página-->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
        const table = document.querySelector("table");
        const headers = table.querySelectorAll("th");
        let sortOrder = 1; // 1 = Crescente, -1 = Decrescente

        headers.forEach((header, columnIndex) => {
            header.addEventListener("click", function () {
                const rows = Array.from(table.querySelector("tbody").rows);
                const isDateColumn = columnIndex === 2; // Índice da coluna de data

                rows.sort((rowA, rowB) => {
                    let cellA = rowA.cells[columnIndex].innerText.trim();
                    let cellB = rowB.cells[columnIndex].innerText.trim();

                    if (isDateColumn) {
                        // Converte as datas para um formato comparável (AAAA-MM-DD)
                        cellA = new Date(cellA.split("/").reverse().join("-"));
                        cellB = new Date(cellB.split("/").reverse().join("-"));
                    } else if (!isNaN(cellA) && !isNaN(cellB)) {
                        // Converte para número se possível
                        cellA = Number(cellA);
                        cellB = Number(cellB);
                    }

                    return cellA > cellB ? sortOrder : cellA < cellB ? -sortOrder : 0;
                });

                sortOrder *= -1; // Alterna a ordem da classificação

                // Remove e reinsere as linhas ordenadas
                const tbody = table.querySelector("tbody");
                tbody.innerHTML = "";
                rows.forEach(row => tbody.appendChild(row));
            });
        });
    });




    document.addEventListener("DOMContentLoaded", function () {
        document.getElementById("status-filter").addEventListener("change", function() {
            let selectedStatus = this.value.trim().toLowerCase(); // Normaliza o valor selecionado
            let rows = document.querySelectorAll(".historico table tbody tr"); // Obtém todas as linhas da tabela

            rows.forEach(row => {
                let statusCell = row.querySelector(".status").textContent.trim().toLowerCase(); // Obtém o status da linha

                // Se "Todos" estiver selecionado ou o status da linha for igual ao selecionado, exibe a linha
                if (selectedStatus === "todos" || statusCell === selectedStatus) {
                    row.style.display = ""; // Exibe a linha
                } else {
                    row.style.display = "none"; // Esconde a linha
                }
            });
        });
    });
    </script>

    
</body>
</html>