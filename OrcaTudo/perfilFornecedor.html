<!DOCTYPE html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Perfil Fornecedor</title>
  <script src="https://kit.fontawesome.com/449a3898b7.js" crossorigin="anonymous"></script>
  <link rel="icon" href="imagens/Logo1.png" type="image/png">
  <link rel="stylesheet" href="css/perfilFornecedor.css">
  <link rel="stylesheet" href="css/header.css">
</head>

<body>


  <header>
    <div class="logo">
      <img src="imagens/Logo1.png" alt="Logo Or√ßaTudo">
    </div>

    <div class="search-bar">
      <div>
        <input id="input" type="text" placeholder="O que voc√™ procura na Or√ßa Tudo?">
        <i class="fas fa-search" id="search"></i>
      </div>
      <ul class="sugestoes">
      </ul>
    </div>

    <nav>
      <ul>
        <li><a href="catalogo.html">Cat√°logo</a></li>
        <li><a id="dashboard">Dashboard</a></li>
      </ul>
    </nav>

    <div class="icons">
      <p id="cadastro">Cadastre-se</p>
      <p id="login">Fa√ßa login</p>
      <div class="user-menu">
        <i class="far fa-user" id="user-icon"></i>
        <div class="dropdown-menu" id="dropdown-menu">
          <a id="perfil">Perfil</a>

          <a id="logout">Sair da Conta</a>
        </div>
      </div>
      <i class="fas fa-shopping-cart" id="cart"></i>
    </div>
  </header>


  <main>
    <div class="container">

      <div class="mainContent">

        <section class="perfil-fornecedor">
          <div class="perfil-img">
            <img src="imagens/userPlaceholder.png" alt="Foto do Fornecedor">
          </div>

          <div class="perfil-info">
            <h2 id="perfil-nome" style="margin-bottom: 20px;">Nome do Fornecedor</h2>
            <h4 class="perfil-area">Area de atua√ß√£o</h4>
            <h4 class="perfil-endereco">endere√ßo</h4>
            <p class="perfil-razao">Raz√£o Social</p>
            <p class="perfil-contato">Contato: emailexemplo@gmail.com</p>
          </div>

          <div class="perfil-sobre">
            <h3>Sobre n√≥s</h3>
            <p id="descricao">
              Somos uma empresa focada em qualidade, inova√ß√£o e compromisso com nossos clientes.
              Oferecemos solu√ß√µes eficientes e personalizadas, sempre com √©tica e transpar√™ncia.
              Nossa equipe qualificada trabalha para entregar resultados que fazem a diferen√ßa,
              garantindo excel√™ncia em cada projeto e construindo rela√ß√µes de confian√ßa.
            </p>
          </div>
        </section>



        <section class="info-geral">
          <div class="container-info">
            <div class="formdata">
              <h4>Nome</h4>
              <input disabled id="nomeFornecedor" type="text" placeholder="Digite o nome do fornecedor">
            </div>
            <div class="formdata">
              <h4>Area de Atua√ß√£o</h4>
              <input disabled id="area" type="text" placeholder="Digite a categoria">
            </div>
            <div class="formdata">
              <h4>CNPJ</h4>
              <input disabled id="cnpj" type="text" placeholder="Digite o CNPJ">
            </div>
            <div class="formdata">
              <h4>Email</h4>
              <input disabled id="email" type="email" placeholder="Digite o email">
            </div>
            <div class="formdata">
              <h4>Telefone</h4>
              <input disabled id="telefone" type="tel" placeholder="Digite o telefone">
            </div>
            <div class="formdata">
              <h4>Endere√ßo</h4>
              <input disabled id="endereco" type="text" placeholder="Digite o endere√ßo">
            </div>
          </div>
        </section>



        <section class="editar-section">
          <h2>Gerenciamento</h2>

          <div class="editar-buttons">
            <button id="gerenciar-produtos" ><i class="fas fa-pen"></i> Gerenciar produtos</button>
            <button id="gerenciar-categorias" ><i class="fas fa-pen"></i> Gerenciar categorias</button>
            <button id="editar"><i class="fas fa-pen"></i>Editar Informa√ß√µes</button>
          </div>
        </section>

      </div>
    </div>
  </main>

  <!--Integra√ß√£o API-->

  <script src="js/Fornecedor.js"></script>
  <script src="js/authUsuario.js"></script>
  <script src="js/produto.js"></script>
  <script>


    // Fun√ß√£o para buscar dados do fornecedor
    async function carregarPerfil() {
      try {
        if (sessionStorage.getItem('token') == null) {
          alert("Voc√™ precisa estar logado para acessar");
          window.location = "login.html";
        }
        const obj = await decodificarJWT(sessionStorage.getItem('token'));
        console.log(obj)
        const fornecedor = await getFornecedorByEmail(obj.sub);

        const nomeFornecedor = document.getElementById('perfil-nome');
        const areaFornecedor = document.getElementsByClassName('perfil-area')[0];
        const contatoFornecedor = document.getElementsByClassName('perfil-contato')[0];
        const razaoFornecedor = document.getElementsByClassName('perfil-razao')[0];
        const enderecoFornecedor = document.getElementsByClassName('perfil-endereco')[0];
        const sobreFornecedor = document.getElementsByClassName('perfil-sobre')[0];


        nomeFornecedor.innerText = fornecedor[0].nome;
        areaFornecedor.innerText = fornecedor[0].area_de_atuacao;
        contatoFornecedor.innerText = "Contato: " + fornecedor[0].email;
        razaoFornecedor.innerText = fornecedor[0].razao_social;
        enderecoFornecedor.innerText = "Logradouro: " + fornecedor[0].endereco;
        sobreFornecedor.innerHTML = "<h3>Sobre n√≥s</h3>" + "<p>" + fornecedor[0].descricao + "</p>";



        document.getElementById("area").value = fornecedor[0].area_de_atuacao;
        document.getElementById("cnpj").value = fornecedor[0].documento;
        document.getElementById("email").value = fornecedor[0].email;
        document.getElementById("telefone").value = fornecedor[0].telefone;
        document.getElementById("endereco").value = fornecedor[0].endereco;
        document.getElementById('perfil-nome').textContent = fornecedor[0].nome;


      } catch (erro) {
        console.error("Erro ao carregar perfil:", erro);
      }
    }
    


    // carrega todos os eventos necess√°rios para o funcionamento do modal de gerenciamento produtos
    function fecharMenuProdutos(){
      document.getElementsByClassName('produtos-menu')[0].style.display = "none";
    }
    async function carregarModalProdutos() {
      document.getElementById('gerenciar-produtos').addEventListener('click', ()=>{
        document.getElementsByClassName('produtos-menu')[0].style.display = "flex";
      })
    }
    // carrega todos os eventos necess√°rios para o funcionamento do modal de categorias
    function fecharModalCategorias(){
      document.getElementsByClassName('categorias-menu')[0].style.display = "none";
    }
    async function carregarModalCategorias() {
      document.getElementById('gerenciar-categorias').addEventListener('click' , ()=>{
        document.getElementsByClassName('categorias-menu')[0].style.display = "flex";
      })
    }
    // Fun√ß√£o para salvar dados atualizados
    async function salvarPerfil() {
      const obj = await decodificarJWT(sessionStorage.getItem('token'));
      console.log(obj)
      const fornecedor = await getFornecedorByEmail(obj.sub);
      console.log("fornecedor: ", fornecedor)
      console.log('salvou!')
      const dados = {
        nome: document.querySelector('input[placeholder="Digite o nome do fornecedor"]').value,
        area_de_atuacao: document.querySelector('input[placeholder="Digite a categoria"]').value,
        documento: document.querySelector('input[placeholder="Digite o CNPJ"]').value,
        email: document.querySelector('input[placeholder="Digite o email"]').value,
        telefone: document.querySelector('input[placeholder="Digite o telefone"]').value,
        endereco: document.querySelector('input[placeholder="Digite o endere√ßo"]').value
      };

      try {
        for (const [chave, valor] of Object.entries(dados)) {
          const resposta = await putFornecedor(fornecedor[0].id, chave, valor);

        }
        // üî• Agora sim, recarregar a p√°gina ap√≥s concluir tudo:
        location.reload();
      } catch (error) {
        console.log(error)
      }
    }
    function editarInfo() {
      btnEditar = document.getElementById('editar');
      console.log("Editarinfo rodou")


      if (btnEditar.innerText === "Editar Informa√ß√µes") {
        console.log("rodou porra!!!");
        document.getElementById("nomeFornecedor").disabled = false;
        document.getElementById("area").disabled = false;
        document.getElementById("cnpj").disabled = false;
        document.getElementById("email").disabled = false;
        document.getElementById("telefone").disabled = false;
        document.getElementById("endereco").disabled = false;
        document.getElementById('perfil-nome').disabled = false;
        btnEditar.innerText = "Salvar";
      } else {
        btnEditar.innerText = "Editar Informa√ß√µes"
        document.getElementById("nomeFornecedor").disabled = true
        document.getElementById("area").disabled = true
        document.getElementById("cnpj").disabled = true
        document.getElementById("email").disabled = true
        document.getElementById("telefone").disabled = true
        document.getElementById("endereco").disabled = true
        document.getElementById('perfil-nome').disabled = true
        salvarPerfil();
      }


    }
    
    
    
    // Quando a p√°gina carregar
    document.addEventListener("DOMContentLoaded", () => {
      carregarPerfil();
      carregarModalProdutos();
      carregarModalCategorias();
      btnEditar = document.getElementById('editar');
      btnEditar.addEventListener('click', () => {
        editarInfo();
      })

    });
  </script>



  <footer>
    <div class="footer-container">
      <div class="footer-section">
        <img src="imagens/Logo.png" alt="Or√ßaTudo Logo" class="footer-logo">
      </div>
      <div class="footer-section">
        <h3>Ideal Para</h3>
        <ul>
          <li>Engenheiros Civis</li>
          <li>Construtoras</li>
          <li>Or√ßamentistas</li>
        </ul>
      </div>
      <div class="footer-section">
        <h3>Funcionalidades</h3>
        <ul>
          <li>Cota√ß√£o de Pre√ßos</li>
          <li>Gest√£o de Or√ßamentos</li>
          <li>Compara√ß√£o de Materiais</li>
        </ul>
      </div>
      <div class="footer-section">
        <h3>Recursos</h3>
        <ul>
          <li>Lista de Fornecedores</li>
          <li>Simula√ß√£o de Custos</li>
          <li>Dashboard Interativo</li>
        </ul>
      </div>
      <div class="footer-section">
        <h3>Sobre</h3>
        <ul>
          <li><a href="#">Sobre o Or√ßaTudo</li>
          <li><a href="#">Contato</a></li>
        </ul>
      </div>
    </div>
    <div class="footer-bottom">
      <p>¬© 2025 Or√ßaTudo. Todos os direitos reservados | Pol√≠tica de Privacidade | Termos de Servi√ßo</p>
    </div>
  </footer>


  <!--modal gerenciar produtos-->
  <div class="produtos-menu">
    <button class="close-btn" onclick="fecharMenuProdutos()">X</button>
    <h2>Gerenciar Produtos</h2>
    <div class="produtos-container">
      <!--conte√∫do que ficar√° a esquerda, preview do produto-->
      <div class="cadastrar-container">
        <h2>Atualizar produto</h2>
        <img src="imagens/placeholder.jpg" alt="imagem produto">
        <div class="preview-info">

          <h3>Nome do produto</h3>
          <h3>Pre√ßo</h3>
          <div>
            <ul>
              <li>Categoria</li>
              <li>Subcategoria</li>
              <li>Categoria final</li>
            </ul>
          </div>
          <p>descri√ß√£o do produto</p>
          <button>Atualizar</button>
          <button>Voltar</button>
        </div>
      </div>
      <!--Conte√∫do que ficar√° a direita, lista de produtos cadastrados-->
      <div class="tabela-container">
        <h3>Produtos cadastrados</h3>
        <table>
          <thead>
            <tr>
              <th>nome</th>
              <th>Categoria</th>
              <th>Atualizar</th>
              <th>Deletar</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>nome do produto</td>
              <td>Ferramentas</td>
              <td class="atualizar" ><a>atualizar</a></td>
              <td class="deletar" ><a>deletar</a></td>
            </tr>
                        <tr>
              <td>nome do produto</td>
              <td>Ferramentas</td>
              <td class="atualizar" ><a>atualizar</a></td>
              <td class="deletar" ><a>deletar</a></td>
            </tr>
                        <tr>
              <td>nome do produto</td>
              <td>Ferramentas</td>
              <td class="atualizar" ><a>atualizar</a></td>
              <td class="deletar" ><a>deletar</a></td>
            </tr>
                        <tr>
              <td>nome do produto</td>
              <td>Ferramentas</td>
              <td class="atualizar" ><a>atualizar</a></td>
              <td class="deletar" ><a>deletar</a></td>
            </tr>
                        <tr>
              <td>nome do produto</td>
              <td>Ferramentas</td>
              <td class="atualizar" ><a>atualizar</a></td>
              <td class="deletar" ><a>deletar</a></td>
            </tr>
                        <tr>
              <td>nome do produto</td>
              <td>Ferramentas</td>
              <td class="atualizar" ><a>atualizar</a></td>
              <td class="deletar" ><a>deletar</a></td>
            </tr>
                        <tr>
              <td>nome do produto</td>
              <td>Ferramentas</td>
              <td class="atualizar" ><a>atualizar</a></td>
              <td class="deletar" ><a>deletar</a></td>
            </tr>
                        <tr>
              <td>nome do produto</td>
              <td>Ferramentas</td>
              <td class="atualizar" ><a>atualizar</a></td>
              <td class="deletar" ><a>deletar</a></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!--modal gerenciar categorias-->
  <div class="categorias-menu" >
    <button onclick="fecharModalCategorias()" class="close-categorias" >X</button>
    <h2>Gerenciar categorias</h2>
    <div class="categorias-container" >
      <!--conte√∫do √† esquerda, sele√ß√£o de categorias, subcategorias, categorias finais-->
      <div class="select-categoria" >
        <h3>Selecione uma categoria para editar</h3>
        <label for="slt-categoria">Categorias</label>
        <select id="sct-categoria" >
          <option>Selecione uma categoria</option>
        </select>
        <label for="slt-subcategoria">Subcategoria</label>
        <select id="slt-subcategoria" >
          <option>Selecione uma subcategoria</option>
        </select>
        <label for="slt-final">Categoria final</label>
        <select id="slt-final" >
          <option value="">Selecioner uma Categoria Final</option>
        </select>
        <button>Limpar sele√ß√£o</button>
      </div>
      <!--conte√∫do √† direita, op√ß√µes de editar ou exluir categoria selecionada, caso nada seelecionada criar-->
      <div class="edit-categoria" >
        <h3>Nova categoria</h3>
        <input disabled type="text" placeholder="Nome da categoria" >
        <div class="option-container" >
          <label>
            <input type="radio" name="option" value="categoria" >
            <span>Categoria</span>
          </label>
          <label>
            <input type="radio" name="option" value="subcategoria" >
            <span>Subcategoria</span>
          </label>
          <label>
            <input type="radio" name="option" value="SubcategoriaFinal" >
            <span>Categoria Final</span>
          </label>
        </div>
        <label for="slt-pai">Pertence √†:</label>
        <select id="slt-pai">
          <option value="">Selecione</option>
        </select>
        <button id="salvar-btn" >Salvar</button>
        <button id="delete-btn" >Excluir</button>
      </div>
    </div>
  </div>
  <!--integra√ß√£o da header-->

  <div id="meuModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="fecharModal()">&times;</span>
      <h2 id="modal-txt">Login como:</h2>
      <button id="fornecedor">Fornecedor</button>
      <button id="usuario">Usu√°rio</button>
    </div>
  </div>
  <script>
    initSearchbar();
    initHeader();
    async function initSearchbar() {
      searchbar = document.getElementById('input');
      let sugestoes = document.getElementsByClassName('sugestoes')[0];
      let results = null;
      searchbar.addEventListener('input', async () => {
        sugestoes.innerHTML = "";
        if (searchbar.value !== null && searchbar.value !== "") {
          results = await produtoNomeLike(searchbar.value)
        }
        results.forEach(prod => {
          li = document.createElement('li');
          li.innerText = prod.nome;
          li.addEventListener('click', () => {
            searchbar.value = "";
            window.location = "cotacao.html?produto=" + prod.id;
          })
          sugestoes.appendChild(li);
        });

        console.log(results);
      })
      icon = document.getElementsByClassName('fas fa-search')[0];
      icon.addEventListener('click', () => {
        window.location = "catalogo.html?search=" + searchbar.value
      })
    }
    function initHeader() {
      logout = document.getElementById('logout');
      cart = document.getElementById('cart');
      dashboard = document.getElementById('dashboard');
      loginTxt = document.getElementById('login');
      cadastroTxt = document.getElementById('cadastro');
      btnFornecedor = document.getElementById('fornecedor');
      btnUsuario = document.getElementById('usuario');
      txtModal = document.getElementById('modal-txt');
      perfil = document.getElementById('perfil');
      modal = document.getElementsByClassName('modal')[0];
      document.addEventListener("DOMContentLoaded", function () {
        const userIcon = document.getElementById("user-icon");
        const dropdownMenu = document.getElementById("dropdown-menu");

        userIcon.addEventListener("click", function (event) {
          event.stopPropagation();
          dropdownMenu.style.display = dropdownMenu.style.display === "block" ? "none" : "block";
        });

        document.addEventListener("click", function () {
          dropdownMenu.style.display = "none";
        });

        dropdownMenu.addEventListener("click", function (event) {
          event.stopPropagation();
        });
      });
      logout.addEventListener('click', () => {

        if (sessionStorage.getItem('token') == null) {
          alert("Voc√™ n√£o est√° logado!")
        } else {
          sessionStorage.removeItem('token');
          alert("Voc√™ deslogou com sucesso!")
          window.location = "landingPage.html"
        }
      })
      perfil.addEventListener('click', async () => {
        token = sessionStorage.getItem('token');
        if (token != null) {
          obj = await decodificarJWT(token);

          fornecedor = await getFornecedorByEmail(obj.sub);
          if (fornecedor == null) {
            window.location = "PerfilFornecedor.html";
          } else {
            window.location = "PerfilUsuario.html";
          }
        } else {
          alert("Voc√™ precisa estar logado")
        }
      })
      dashboard.addEventListener('click', async () => {
        if (sessionStorage.getItem('token' == null)) {
          alert("Voc√™ precisa estar logado");
        } else {
          token = sessionStorage.getItem('token');
          if (token != null) {
            obj = await decodificarJWT(token);

            fornecedor = await getFornecedorByEmail(obj.sub);
            if (fornecedor == null) {
              window.location = "dashboard.html";
            } else {
              window.location = "dashboardusuario.html";
            }
          } else {
            alert("Voc√™ precisa estar logado")
          }

        }
      })
      cart.addEventListener('click', () => {
        if (sessionStorage.getItem('token') == null) {
          alert("Voc√™ precisa estar logado");
        } else {
          window.location = "carrinho.html";
        }
      })

      loginTxt.addEventListener('click', () => {
        txtModal.innerText = "login como:"
        modal.style.display = 'block';
        btnFornecedor.addEventListener('click', () => {
          window.location = "loginFornecedor.html";
        })
        btnUsuario.addEventListener('click', () => {
          window.location = "login.html"
        })
      })
      cadastroTxt.addEventListener('click', () => {
        txtModal.innerText = "Cadastrar-se como:"
        modal.style.display = 'block';
        btnFornecedor.addEventListener('click', () => {
          window.location = "cadastroFornecedor.html"
        })
        btnUsuario.addEventListener('click', () => {
          window.location = "cadastroUsuario.html"
        })
      })

    }
    function fecharModal() {
      modal.style.display = "none";
    }
  </script>


</body>

</html>